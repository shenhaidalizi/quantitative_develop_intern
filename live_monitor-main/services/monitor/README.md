# ðŸ“Š Stock Monitor Service

è‚¡ç¥¨ç›‘æŽ§WebæœåŠ¡ - å®žæ—¶å±•ç¤ºè‚¡ç¥¨åˆ†é’Ÿçº§æ•°æ®åˆ†æžç»“æžœ

## ðŸ—ï¸ é¡¹ç›®ç»“æž„

```
monitor/
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ routes/            # APIè·¯ç”±
â”‚   â”œâ”€â”€ middlewares/       # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ public/            # é™æ€èµ„æº
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ scripts/               # è¾…åŠ©è„šæœ¬
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ Dockerfile            # Dockeré•œåƒæž„å»º
â””â”€â”€ package.json          # é¡¹ç›®é…ç½®

```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### Dockeræ–¹å¼ï¼ˆæŽ¨èï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
make up

# æˆ–ä½¿ç”¨docker-compose
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
make logs-monitor
```

### æœ¬åœ°å¼€å‘

1. **å®‰è£…ä¾èµ–**
```bash
npm install
```

2. **é…ç½®çŽ¯å¢ƒå˜é‡**
```bash
# åˆ›å»º.envæ–‡ä»¶
cat > .env << EOF
PORT=8006
STOCK_FOLDER=/app/data/test_result
INDEX_FOLDER=/app/data/index_data
USE_REDIS=true
REDIS_HOST=localhost
REDIS_PORT=6379
EOF
```

3. **å¯åŠ¨æœåŠ¡**
```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

4. **è®¿é—®ç•Œé¢**
```
http://localhost:8006
```

## ðŸ“¡ APIæŽ¥å£

### çŠ¶æ€æ£€æŸ¥
```bash
GET /api/status
```

### æ•°æ®æŒ‡çº¹ï¼ˆè½»é‡çº§æ£€æŸ¥ï¼‰
```bash
GET /api/status/fingerprint
```

### è‚¡ç¥¨æ•°æ®
```bash
GET /api/stock-data?sort=r5_z&order=desc&page=1&limit=100&search=600
```

å‚æ•°ï¼š
- `sort`: æŽ’åºå­—æ®µï¼ˆr1_z, r5_z, r10_z, r30_z, Chgç­‰ï¼‰
- `order`: æŽ’åºæ–¹å‘ï¼ˆasc/descï¼‰
- `page`: é¡µç 
- `limit`: æ¯é¡µæ•°é‡ï¼ˆä¸ä¼ è¿”å›žå…¨éƒ¨ï¼‰
- `search`: æœç´¢å…³é”®è¯ï¼ˆä»£ç æˆ–åç§°ï¼‰

### è‚¡æŒ‡æ•°æ®
```bash
GET /api/index-data?sort=r5_z&order=desc
```

### æ‰‹åŠ¨é‡æ–°åŠ è½½
```bash
POST /api/status/reload
```

## âš™ï¸ é…ç½®è¯´æ˜Ž

### çŽ¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜Ž | é»˜è®¤å€¼ |
|------|------|--------|
| `PORT` | æœåŠ¡ç«¯å£ | 8006 |
| `NODE_ENV` | è¿è¡ŒçŽ¯å¢ƒ | development |
| `STOCK_FOLDER` | è‚¡ç¥¨æ•°æ®ç›®å½• | /app/data/test_result |
| `INDEX_FOLDER` | è‚¡æŒ‡æ•°æ®ç›®å½• | /app/data/index_data |
| `USE_REDIS` | å¯ç”¨Redisç¼“å­˜ | false |
| `REDIS_HOST` | Redisä¸»æœº | localhost |
| `REDIS_PORT` | Redisç«¯å£ | 6379 |
| `REDIS_PASSWORD` | Rediså¯†ç  | - |
| `REDIS_DB` | Redisæ•°æ®åº“ | 0 |
| `REDIS_TTL` | ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ | 60 |

## ðŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
```bash
npm test
```

### é›†æˆæµ‹è¯•ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
```bash
npm run test:integration
```

### ç”Ÿæˆæµ‹è¯•æ•°æ®
```bash
# ç”Ÿæˆä¸€æ¬¡æ€§æµ‹è¯•æ•°æ®
node scripts/test_data_generator.js

# æŒç»­ç”Ÿæˆï¼ˆæ¯30ç§’æ›´æ–°ï¼‰
node scripts/test_data_generator.js --continuous --interval=30
```

## ðŸ” åŠŸèƒ½ç‰¹æ€§

- âœ… **å®žæ—¶æ–‡ä»¶ç›‘æŽ§**: ä½¿ç”¨chokidarç›‘æŽ§CSVæ–‡ä»¶å˜åŒ–
- âœ… **Redisç¼“å­˜**: å¯é€‰Redisæ”¯æŒï¼Œæå‡60-80%å“åº”é€Ÿåº¦
- âœ… **GzipåŽ‹ç¼©**: è‡ªåŠ¨åŽ‹ç¼©å“åº”ï¼Œå‡å°‘70-80%ä¼ è¾“é‡
- âœ… **åˆ†é¡µæ”¯æŒ**: å¤§æ•°æ®é›†æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- âœ… **æ•°æ®ç­›é€‰**: æ”¯æŒæŒ‰ä»£ç /åç§°æœç´¢
- âœ… **å¤šå­—æ®µæŽ’åº**: æ”¯æŒå¤šä¸ªæŒ‡æ ‡æŽ’åº
- âœ… **å¥åº·æ£€æŸ¥**: å†…ç½®å¥åº·æ£€æŸ¥æŽ¥å£
- âœ… **ä¼˜é›…å…³é—­**: æ­£ç¡®å¤„ç†SIGINT/SIGTERMä¿¡å·

## ðŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®æž¶æž„

```
è¯·æ±‚ â†’ Express â†’ è·¯ç”±å±‚ â†’ æœåŠ¡å±‚ â†’ æ•°æ®å±‚
                â†“
            ä¸­é—´ä»¶
        (æ—¥å¿—/é”™è¯¯å¤„ç†)
```

### æ·»åŠ æ–°API

1. åœ¨ `src/routes/` åˆ›å»ºè·¯ç”±æ–‡ä»¶
2. åœ¨ `src/services/` æ·»åŠ ä¸šåŠ¡é€»è¾‘
3. åœ¨ `src/routes/index.js` æ³¨å†Œè·¯ç”±

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ES6+è¯­æ³•
- å‡½æ•°å’Œç±»æ·»åŠ JSDocæ³¨é‡Š
- éµå¾ªAirbnb JavaScripté£Žæ ¼æŒ‡å—

## ðŸš¨ æ•…éšœæŽ’æŸ¥

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :8006

# é‡Šæ”¾ç«¯å£
bash scripts/kill_port.sh 8006
```

### Redisè¿žæŽ¥å¤±è´¥
ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§åˆ°å†…å­˜ç¼“å­˜ï¼ŒåŠŸèƒ½ä¸å—å½±å“

### æ•°æ®æ–‡ä»¶å¤¹ä¸å­˜åœ¨
æ£€æŸ¥çŽ¯å¢ƒå˜é‡é…ç½®å’Œæ–‡ä»¶å¤¹æƒé™

### Dockeræ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹monitoræœåŠ¡æ—¥å¿—
docker-compose logs -f monitor

# æŸ¥çœ‹æœ€è¿‘50è¡Œ
docker-compose logs --tail=50 monitor
```

## ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å·²å®žçŽ°
- âœ… GzipåŽ‹ç¼©
- âœ… Redisç¼“å­˜
- âœ… æ•°æ®æŒ‡çº¹æ£€æµ‹
- âœ… å¢žé‡æ›´æ–°

### å»ºè®®
- å¯ç”¨Rediså¯æå‡60-80%æ€§èƒ½
- ç”Ÿäº§çŽ¯å¢ƒå»ºè®®è®¾ç½®limitå‚æ•°
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®æ–‡ä»¶

## ðŸ“ å˜æ›´æ—¥å¿—

### v2.0.0 (2025-10-07)
- âœ¨ å®Œå…¨é‡æž„ä¸ºæ¨¡å—åŒ–æž¶æž„
- âœ¨ æ–°å¢žservicesã€routesã€middlewaresåˆ†å±‚
- âœ¨ ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ¨ æ”¹è¿›Dockeræ”¯æŒ
- âœ¨ ç»Ÿä¸€é…ç½®ç®¡ç†

### v1.0.0
- åˆå§‹ç‰ˆæœ¬

## ðŸ“„ è®¸å¯è¯

MIT License

## ðŸ‘¤ ä½œè€…

panwen

---

**æç¤º**: ç”Ÿäº§çŽ¯å¢ƒå»ºè®®é€šè¿‡Dockeréƒ¨ç½²ï¼Œæœ¬åœ°å¼€å‘ä½¿ç”¨npmè„šæœ¬ã€‚

